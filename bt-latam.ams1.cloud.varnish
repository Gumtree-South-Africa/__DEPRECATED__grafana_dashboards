{"style": "dark", "description": "A dashboard to use to debug a running varnish instance. Easily track requests, cache hits, network i/o, sessions, threads, bans, ban lurker and the ban list size", "links": [], "tags": [], "graphTooltip": 0, "title": "Varnish", "editable": true, "iteration": 1581714602573, "annotations": {"list": [{"enable": true, "hide": true, "name": "Annotations & Alerts", "builtIn": 1, "datasource": "-- Grafana --", "type": "dashboard", "iconColor": "rgba(0, 211, 255, 1)"}]}, "gnetId": 9903, "timepicker": {"time_options": ["5m", "15m", "1h", "6h", "12h", "24h", "2d", "7d", "30d"], "now": true, "nowDelay": "", "refresh_intervals": ["5s", "15s", "30s", "1m", "5m", "15m", "30m", "1h", "2h", "1d"]}, "refresh": "15s", "version": 3, "time": {"to": "now", "from": "now/d"}, "uid": "9TN6EUUWz", "timezone": "utc", "schemaVersion": 18, "panels": [{"repeat": "cluster", "title": "Row title", "collapsed": false, "gridPos": {"y": 0, "h": 1, "w": 24, "x": 0}, "panels": [], "type": "row", "id": 25}, {"mappingTypes": [{"name": "value to text", "value": 1}, {"name": "range to text", "value": 2}], "timeFrom": null, "links": [], "valueMaps": [{"text": "N/A", "value": "null", "op": "="}], "tableColumn": "", "thresholds": "", "rangeMaps": [{"text": "N/A", "from": "null", "to": "null"}], "nullPointMode": "connected", "colors": ["rgba(245, 54, 54, 0.9)", "rgba(237, 129, 40, 0.89)", "rgba(50, 172, 45, 0.97)"], "gauge": {"thresholdLabels": false, "show": false, "thresholdMarkers": true, "maxValue": 100, "minValue": 0}, "gridPos": {"y": 1, "h": 5, "w": 4, "x": 0}, "id": 9, "maxDataPoints": 100, "mappingType": 1, "colorBackground": false, "title": "Frontend Requests", "sparkline": {"full": false, "fillColor": "rgba(31, 118, 189, 0.18)", "lineColor": "rgb(31, 120, 193)", "show": false}, "targets": [{"format": "time_series", "expr": "sum(irate(varnish_main_client_req{instance=~\"^($varnish_instance).*\"}[5m]))", "metric": "", "interval": "15s", "step": 15, "legendFormat": "", "intervalFactor": 1, "refId": "A"}], "prefixFontSize": "100%", "valueName": "current", "type": "singlestat", "valueFontSize": "70%", "format": "none", "editable": true, "cacheTimeout": null, "transparent": true, "postfix": " / sec", "decimals": 1, "interval": null, "prefix": "", "datasource": "Prometheus", "error": false, "nullText": null, "postfixFontSize": "50%", "options": {}, "colorValue": false}, {"mappingTypes": [{"name": "value to text", "value": 1}, {"name": "range to text", "value": 2}], "links": [], "valueMaps": [{"text": "N/A", "value": "null", "op": "="}], "tableColumn": "", "thresholds": "", "rangeMaps": [{"text": "N/A", "from": "null", "to": "null"}], "nullPointMode": "connected", "colors": ["rgba(245, 54, 54, 0.9)", "rgba(237, 129, 40, 0.89)", "rgba(50, 172, 45, 0.97)"], "gauge": {"thresholdLabels": false, "show": false, "thresholdMarkers": true, "maxValue": 100, "minValue": 0}, "gridPos": {"y": 1, "h": 5, "w": 4, "x": 4}, "id": 2, "maxDataPoints": 100, "mappingType": 1, "colorBackground": false, "title": "Backend Requests", "sparkline": {"full": false, "fillColor": "rgba(31, 118, 189, 0.18)", "lineColor": "rgb(31, 120, 193)", "show": false}, "targets": [{"format": "time_series", "expr": "irate(varnish_main_backend_req{instance=~\"^$varnish_instance.*\"}[5m])", "metric": "varnish_main_backend_req", "interval": "15s", "step": 15, "legendFormat": "", "intervalFactor": 1, "refId": "A"}], "prefixFontSize": "100%", "valueName": "current", "type": "singlestat", "valueFontSize": "70%", "format": "none", "editable": true, "cacheTimeout": null, "transparent": true, "postfix": " / sec", "decimals": 1, "interval": null, "prefix": "", "datasource": "Prometheus", "error": false, "nullText": null, "postfixFontSize": "50%", "options": {}, "colorValue": false}, {"mappingTypes": [{"name": "value to text", "value": 1}, {"name": "range to text", "value": 2}], "links": [], "valueMaps": [{"text": "N/A", "value": "null", "op": "="}], "tableColumn": "", "thresholds": "", "rangeMaps": [{"text": "N/A", "from": "null", "to": "null"}], "nullPointMode": "connected", "prefix": "", "gauge": {"thresholdLabels": false, "show": false, "thresholdMarkers": true, "maxValue": 100, "minValue": 0}, "gridPos": {"y": 1, "h": 5, "w": 2, "x": 8}, "id": 16, "maxDataPoints": 100, "mappingType": 1, "colorBackground": false, "title": "Loaded VMODs", "sparkline": {"full": false, "fillColor": "rgba(31, 118, 189, 0.18)", "lineColor": "rgb(31, 120, 193)", "show": false}, "targets": [{"format": "time_series", "expr": "sum(varnish_main_vmods{instance=~\"^($varnish_instance).*\"})", "interval": "", "step": 600, "legendFormat": "", "intervalFactor": 2, "refId": "A"}], "prefixFontSize": "50%", "valueName": "avg", "type": "singlestat", "valueFontSize": "70%", "format": "none", "cacheTimeout": null, "transparent": true, "postfix": "", "interval": null, "colors": ["rgba(245, 54, 54, 0.9)", "rgba(237, 129, 40, 0.89)", "rgba(50, 172, 45, 0.97)"], "datasource": "Prometheus", "nullText": null, "postfixFontSize": "50%", "options": {}, "colorValue": false}, {"mappingTypes": [{"name": "value to text", "value": 1}, {"name": "range to text", "value": 2}], "links": [], "valueMaps": [{"text": "N/A", "value": "null", "op": "="}], "tableColumn": "__name__", "thresholds": "", "rangeMaps": [{"text": "N/A", "from": "null", "to": "null"}], "nullPointMode": "connected", "colors": ["rgba(245, 54, 54, 0.9)", "rgb(96, 96, 96)", "rgba(50, 172, 45, 0.97)"], "gauge": {"thresholdLabels": false, "show": false, "thresholdMarkers": true, "maxValue": 100, "minValue": 0}, "gridPos": {"y": 1, "h": 5, "w": 4, "x": 10}, "id": 18, "maxDataPoints": 100, "mappingType": 1, "colorBackground": false, "title": "Uptime", "sparkline": {"full": false, "fillColor": "rgba(31, 118, 189, 0.18)", "lineColor": "rgb(31, 120, 193)", "show": false}, "targets": [{"format": "time_series", "expr": "min(varnish_main_uptime{instance=~\"^($varnish_instance).*\"})", "step": 600, "legendFormat": "", "intervalFactor": 2, "refId": "A"}], "prefixFontSize": "50%", "valueName": "current", "type": "singlestat", "valueFontSize": "50%", "format": "dtdurations", "editable": true, "cacheTimeout": null, "transparent": true, "postfix": "", "decimals": null, "interval": null, "prefix": "", "datasource": "Prometheus", "error": false, "nullText": null, "postfixFontSize": "50%", "options": {}, "colorValue": true}, {"mappingTypes": [{"name": "value to text", "value": 1}, {"name": "range to text", "value": 2}], "colorBackground": false, "valueMaps": [{"text": "N/A", "value": "null", "op": "="}], "tableColumn": "Value", "thresholds": "0,0,0.1", "rangeMaps": [{"text": "N/A", "from": "null", "to": "null"}], "height": "", "colors": ["rgba(245, 54, 54, 0.9)", "rgba(237, 129, 40, 0.89)", "rgba(50, 172, 45, 0.97)"], "gauge": {"thresholdLabels": false, "show": true, "thresholdMarkers": false, "maxValue": 1, "minValue": 0}, "gridPos": {"y": 1, "h": 5, "w": 10, "x": 14}, "id": 6, "maxDataPoints": 100, "mappingType": 1, "links": [], "title": "Cache Hit Rate", "sparkline": {"full": false, "fillColor": "rgba(31, 118, 189, 0.18)", "lineColor": "rgb(31, 120, 193)", "show": false}, "targets": [{"hide": false, "format": "time_series", "expr": "avg(( rate(varnish_main_cache_hit{instance=~\"^($varnish_instance).*\"}[5m]) / rate(varnish_main_client_req{instance=~\"^($varnish_instance).*\"}[5m]) ))", "metric": "", "interval": "", "step": 600, "legendFormat": "", "intervalFactor": 2, "refId": "A"}], "prefixFontSize": "100%", "valueName": "current", "type": "singlestat", "valueFontSize": "70%", "description": "", "format": "percentunit", "editable": true, "hideTimeOverride": false, "nullPointMode": "connected", "transparent": true, "postfix": "", "postfixFontSize": "50%", "interval": null, "prefix": "", "cacheTimeout": null, "datasource": "Prometheus", "error": false, "nullText": null, "decimals": null, "options": {}, "colorValue": false}, {"repeat": null, "title": "Row title", "collapsed": false, "gridPos": {"y": 6, "h": 1, "w": 24, "x": 0}, "panels": [], "type": "row", "id": 26}, {"bars": false, "timeFrom": null, "links": [], "thresholds": [], "spaceLength": 10, "nullPointMode": "connected", "renderer": "flot", "gridPos": {"y": 7, "h": 13, "w": 12, "x": 0}, "linewidth": 1, "steppedLine": false, "id": 8, "fill": 4, "title": "Requests", "tooltip": {"sort": 0, "shared": true, "value_type": "cumulative", "msResolution": false}, "stack": false, "targets": [{"format": "time_series", "expr": "sum(irate(varnish_main_client_req{instance=~\"^($varnish_instance).*\"}[5m]))", "metric": "", "interval": "", "step": 30, "legendFormat": "frontend", "intervalFactor": 1, "refId": "A"}, {"format": "time_series", "expr": "sum(irate(varnish_main_backend_req{instance=~\"^($varnish_instance).*\"}[5m]))", "interval": "", "step": 30, "legendFormat": "backend", "intervalFactor": 1, "refId": "B"}, {"format": "time_series", "expr": "sum(varnish_main_fetch_total{instance=~\"^($varnish_instance).*\"})", "step": 60, "legendFormat": "fetch total", "intervalFactor": 2, "refId": "C"}, {"format": "time_series", "expr": "sum(irate(varnish_main_fetch_total{instance=~\"^($varnish_instance).*\"}[5m]))", "step": 60, "legendFormat": "fetched objects", "intervalFactor": 2, "refId": "D"}], "transparent": true, "yaxes": [{"logBase": 1, "show": true, "max": null, "format": "none", "min": 1, "label": ""}, {"logBase": 1, "show": false, "max": null, "format": "none", "min": 0, "label": ""}], "xaxis": {"buckets": null, "show": true, "values": [], "mode": "time", "name": null}, "seriesOverrides": [{"alias": "fetch total", "yaxis": 2, "fill": 0}, {"color": "#508642", "alias": "frontend"}, {"color": "#CCA300", "alias": "backend"}], "percentage": false, "type": "graph", "dashes": false, "error": false, "editable": true, "grid": {}, "dashLength": 10, "legend": {"rightSide": false, "total": true, "sideWidth": 400, "min": false, "max": true, "show": true, "current": false, "hideEmpty": false, "values": true, "alignAsTable": true, "avg": true, "hideZero": false}, "yaxis": {"align": false, "alignLevel": null}, "timeShift": null, "aliasColors": {}, "lines": true, "points": false, "datasource": "Prometheus", "pointradius": 5, "timeRegions": [], "decimals": 0, "options": {}}, {"bars": false, "timeFrom": null, "links": [], "thresholds": [], "spaceLength": 10, "nullPointMode": "connected", "renderer": "flot", "gridPos": {"y": 7, "h": 13, "w": 12, "x": 12}, "linewidth": 0, "steppedLine": true, "id": 14, "fill": 6, "title": "Cache hits", "tooltip": {"sort": 0, "shared": true, "value_type": "individual", "msResolution": false}, "legend": {"rightSide": false, "total": false, "min": true, "max": true, "show": true, "current": false, "hideEmpty": false, "values": true, "alignAsTable": true, "avg": true, "hideZero": false}, "targets": [{"hide": false, "format": "time_series", "expr": "avg(rate(varnish_main_cache_hit{instance=~\"^($varnish_instance).*\"}[5m]) / rate(varnish_main_client_req{instance=~\"^($varnish_instance).*\"}[5m]))", "interval": "", "step": 60, "legendFormat": "cache hit %", "intervalFactor": 2, "refId": "A"}, {"hide": false, "format": "time_series", "expr": "avg(1 - (rate(varnish_main_cache_hit{instance=~\"^($varnish_instance).*\"}[5m]) / rate(varnish_main_client_req{instance=~\"^($varnish_instance).*\"}[5m])))", "interval": "", "step": 60, "legendFormat": "cache miss %", "intervalFactor": 2, "refId": "B"}, {"hide": false, "format": "time_series", "expr": "avg(1 - (rate(varnish_main_cache_hitpass{instance=~\"^($varnish_instance).*\"}[5m]) / rate(varnish_main_client_req{instance=~\"^($varnish_instance).*\"}[5m])))", "interval": "", "step": 60, "legendFormat": "cache hit pass %", "intervalFactor": 2, "refId": "C"}], "transparent": true, "yaxes": [{"logBase": 1, "show": true, "max": "1", "format": "percentunit", "min": "0", "label": ""}, {"logBase": 1, "show": false, "max": null, "format": "short", "min": null, "label": null}], "xaxis": {"buckets": null, "show": true, "values": [], "mode": "time", "name": null}, "seriesOverrides": [{"color": "#890F02", "alias": "cache miss %"}, {"color": "#508642", "alias": "cache hit %"}, {"color": "#C15C17", "alias": "cache hit pass %"}], "percentage": false, "type": "graph", "dashes": false, "grid": {}, "dashLength": 10, "stack": true, "yaxis": {"align": false, "alignLevel": null}, "timeShift": null, "aliasColors": {}, "lines": true, "points": false, "datasource": "Prometheus", "pointradius": 5, "timeRegions": [], "options": {}}, {"repeat": null, "title": "Row title", "collapsed": false, "gridPos": {"y": 20, "h": 1, "w": 24, "x": 0}, "panels": [], "type": "row", "id": 27}, {"bars": false, "timeFrom": null, "links": [], "thresholds": [], "spaceLength": 10, "nullPointMode": "connected", "renderer": "flot", "gridPos": {"y": 21, "h": 13, "w": 12, "x": 0}, "linewidth": 1, "steppedLine": false, "id": 12, "fill": 5, "title": "Network", "tooltip": {"sort": 2, "shared": true, "value_type": "individual", "msResolution": false}, "stack": true, "targets": [{"hide": false, "format": "time_series", "expr": "sum(irate(varnish_main_s_resp_hdrbytes{instance=~\"^($varnish_instance).*\"}[5m]) + irate(varnish_main_s_resp_bodybytes{instance=~\"^($varnish_instance).*\"}[5m]))", "interval": "", "step": 30, "legendFormat": "frontend", "intervalFactor": 1, "refId": "A"}, {"hide": false, "format": "time_series", "expr": "sum(irate(varnish_backend_beresp_hdrbytes{instance=~\"^($varnish_instance).*\"}[5m]) + irate(varnish_backend_beresp_bodybytes{instance=~\"^($varnish_instance).*\"}[5m]))", "metric": "", "interval": "", "step": 30, "legendFormat": "backend", "intervalFactor": 1, "refId": "B"}, {"format": "time_series", "expr": "sum(irate(varnish_backend_beresp_hdrbytes{instance=~\"^($varnish_instance).*\"}[5m]) + irate(varnish_backend_beresp_bodybytes{instance=~\"^($varnish_instance).*\"}[5m])) by (backend)", "step": 60, "legendFormat": "backend {{ backend }}", "intervalFactor": 2, "refId": "C"}], "transparent": true, "yaxes": [{"logBase": 1, "show": true, "max": null, "format": "bytes", "min": "1024", "label": ""}, {"show": true, "max": null, "logBase": 1, "min": null, "format": "short"}], "xaxis": {"buckets": null, "show": true, "values": [], "mode": "time", "name": null}, "seriesOverrides": [{"alias": "/backend .*/", "fill": 7}, {"color": "#508642", "alias": "frontend", "zindex": -2, "stack": false}, {"color": "#CCA300", "alias": "/^backend$/", "zindex": 1, "stack": false, "fill": 0}], "percentage": false, "type": "graph", "dashes": false, "error": false, "editable": true, "hideTimeOverride": false, "grid": {}, "dashLength": 10, "legend": {"sort": null, "rightSide": false, "total": true, "sideWidth": 400, "min": false, "max": true, "show": true, "current": false, "hideEmpty": true, "values": true, "alignAsTable": true, "avg": true, "sortDesc": null, "hideZero": true}, "yaxis": {"align": false, "alignLevel": null}, "timeShift": null, "aliasColors": {}, "lines": true, "points": false, "datasource": "Prometheus", "pointradius": 5, "timeRegions": [], "decimals": null, "options": {}}, {"bars": false, "timeFrom": null, "links": [], "thresholds": [], "spaceLength": 10, "nullPointMode": "connected", "renderer": "flot", "gridPos": {"y": 21, "h": 13, "w": 12, "x": 12}, "linewidth": 1, "steppedLine": false, "id": 13, "fill": 4, "title": "Cache", "tooltip": {"sort": 0, "shared": true, "value_type": "cumulative", "msResolution": false}, "stack": false, "targets": [{"format": "time_series", "expr": "sum(irate(varnish_main_n_expired{instance=~\"^($varnish_instance).*\"}[5m]))", "metric": "varnish_main_n_object", "interval": "", "step": 60, "legendFormat": "expired", "intervalFactor": 2, "refId": "A"}, {"format": "time_series", "expr": "sum(irate(varnish_main_n_lru_moved{instance=~\"^($varnish_instance).*\"}[5m]))", "interval": "", "step": 60, "legendFormat": "LRU moved", "intervalFactor": 2, "refId": "C"}, {"format": "time_series", "expr": "sum(irate(varnish_main_n_lru_nuked{instance=~\"^($varnish_instance).*\"}[5m]))", "interval": "", "step": 60, "legendFormat": "LRU nuked", "intervalFactor": 2, "refId": "B"}, {"format": "time_series", "expr": "sum(varnish_sma_g_bytes{type=\"s0\", instance=~\"^($varnish_instance).*\"})", "metric": "", "step": 60, "legendFormat": "mem used", "intervalFactor": 2, "refId": "E"}], "transparent": true, "yaxes": [{"show": true, "max": null, "logBase": 1, "min": 1, "format": "none"}, {"show": true, "max": null, "logBase": 1, "min": 1, "format": "bytes"}], "xaxis": {"buckets": null, "show": true, "values": [], "mode": "time", "name": null}, "seriesOverrides": [{"color": "#82B5D8", "alias": "/.*expired/"}, {"color": "#F9E2D2", "alias": "/.*LRU moved/"}, {"color": "#BF1B00", "alias": "/.*LRU nuked/"}, {"color": "#BA43A9", "alias": "/.*mem /", "yaxis": 2, "fill": 0}], "percentage": false, "type": "graph", "dashes": false, "error": false, "editable": true, "hideTimeOverride": false, "grid": {}, "dashLength": 10, "legend": {"sort": null, "rightSide": false, "total": true, "min": true, "max": true, "show": true, "current": true, "values": true, "alignAsTable": true, "avg": false, "sortDesc": null, "hideZero": false}, "yaxis": {"align": false, "alignLevel": null}, "timeShift": null, "aliasColors": {}, "lines": true, "points": false, "datasource": "Prometheus", "pointradius": 5, "timeRegions": [], "decimals": 2, "options": {}}, {"title": "New row", "collapsed": false, "gridPos": {"y": 34, "h": 1, "w": 24, "x": 0}, "panels": [], "type": "row", "id": 28}, {"bars": false, "timeFrom": null, "links": [], "isNew": true, "thresholds": [], "spaceLength": 10, "nullPointMode": "connected", "renderer": "flot", "gridPos": {"y": 35, "h": 13, "w": 12, "x": 0}, "linewidth": 2, "steppedLine": false, "id": 21, "fill": 1, "title": "Backend Connections (per minute)", "tooltip": {"sort": 0, "shared": true, "value_type": "cumulative", "msResolution": false}, "stack": false, "targets": [{"intervalFactor": 2, "expr": "rate(varnish_main_backend_conn{instance=~\"^($varnish_instance).*\"}[1m])", "step": 60, "refId": "A", "legendFormat": "Backend conn. success"}, {"intervalFactor": 2, "expr": "rate(varnish_main_backend_recycle{instance=~\"^($varnish_instance).*\"}[1m])", "step": 60, "refId": "B", "legendFormat": "Backend conn. recycles"}, {"intervalFactor": 2, "expr": "rate(varnish_main_backend_reuse{instance=~\"^($varnish_instance).*\"}[1m])", "step": 60, "refId": "C", "legendFormat": "Backend conn. reuses"}, {"intervalFactor": 2, "expr": "rate(varnish_main_backend_fail{instance=~\"^($varnish_instance).*\"}[1m])", "step": 60, "refId": "D", "legendFormat": "Backend conn. failures"}, {"intervalFactor": 2, "expr": "rate(varnish_main_backend_unhealthy{instance=~\"^($varnish_instance).*\"}[1m])", "step": 60, "refId": "E", "legendFormat": "Backend conn. not attempted"}, {"intervalFactor": 2, "expr": "rate(varnish_main_backend_busy{instance=~\"^($varnish_instance).*\"}[1m])", "step": 60, "refId": "F", "legendFormat": "Backend conn. too many"}, {"intervalFactor": 2, "expr": "rate(varnish_main_backend_req{instance=~\"^($varnish_instance).*\"}[1m])", "step": 60, "refId": "G", "legendFormat": "Backend requests made"}, {"intervalFactor": 2, "expr": "rate(varnish_main_backend_retry{instance=~\"^($varnish_instance).*\"}[1m])", "step": 60, "refId": "H", "legendFormat": "Backend conn. retry"}, {"intervalFactor": 2, "expr": "rate(varnish_backend_conn{instance=~\"^($varnish_instance).*\"}[1m])", "step": 60, "refId": "I", "legendFormat": "Concurrent connections to backend"}], "transparent": true, "yaxes": [{"logBase": 1, "show": true, "max": null, "format": "short", "min": 0, "label": null}, {"logBase": 1, "show": true, "max": null, "format": "short", "min": null, "label": null}], "xaxis": {"buckets": null, "show": true, "values": [], "mode": "time", "name": null}, "seriesOverrides": [], "percentage": false, "type": "graph", "dashes": false, "error": false, "editable": true, "grid": {}, "dashLength": 10, "legend": {"rightSide": false, "total": false, "min": false, "max": true, "show": true, "current": true, "values": true, "alignAsTable": true, "avg": true}, "yaxis": {"align": false, "alignLevel": null}, "timeShift": null, "aliasColors": {}, "lines": true, "points": false, "datasource": "Prometheus", "pointradius": 5, "timeRegions": [], "options": {}}, {"bars": false, "timeFrom": null, "links": [], "isNew": true, "thresholds": [], "spaceLength": 10, "nullPointMode": "connected", "renderer": "flot", "gridPos": {"y": 35, "h": 13, "w": 12, "x": 12}, "linewidth": 2, "steppedLine": false, "id": 19, "fill": 1, "title": "Sessions", "tooltip": {"sort": 0, "shared": true, "value_type": "cumulative", "msResolution": false}, "stack": false, "targets": [{"intervalFactor": 2, "expr": "sum by(type) (rate(varnish_main_sessions{instance=~\"^($varnish_instance).*\"}[1m]))", "step": 60, "refId": "A", "legendFormat": "session - {{type}}"}], "transparent": true, "yaxes": [{"logBase": 1, "show": true, "max": null, "format": "short", "min": null, "label": null}, {"logBase": 1, "show": true, "max": null, "format": "short", "min": null, "label": null}], "xaxis": {"buckets": null, "show": true, "values": [], "mode": "time", "name": null}, "seriesOverrides": [], "percentage": false, "type": "graph", "dashes": false, "error": false, "editable": true, "grid": {}, "dashLength": 10, "legend": {"sort": "max", "rightSide": false, "total": false, "min": false, "max": true, "show": true, "current": true, "values": true, "alignAsTable": true, "avg": true, "sortDesc": true}, "yaxis": {"align": false, "alignLevel": null}, "timeShift": null, "aliasColors": {}, "lines": true, "points": false, "datasource": "Prometheus", "pointradius": 5, "timeRegions": [], "options": {}}, {"bars": false, "timeFrom": null, "links": [], "isNew": true, "thresholds": [], "spaceLength": 10, "nullPointMode": "connected", "renderer": "flot", "gridPos": {"y": 48, "h": 13, "w": 12, "x": 0}, "linewidth": 2, "steppedLine": false, "id": 20, "fill": 1, "title": "Threads", "tooltip": {"sort": 0, "shared": true, "value_type": "cumulative", "msResolution": false}, "stack": false, "targets": [{"expr": "varnish_main_threads_created{instance=~\"^($varnish_instance).*\"}", "metric": "varnish_main_threads_created", "step": 60, "legendFormat": "Threads created", "intervalFactor": 2, "refId": "A"}, {"intervalFactor": 2, "expr": "varnish_main_threads_destroyed{instance=~\"^($varnish_instance).*\"}", "step": 60, "refId": "B", "legendFormat": "Threads destroyed"}, {"intervalFactor": 2, "expr": "varnish_main_threads_failed{instance=~\"^($varnish_instance).*\"}", "step": 60, "refId": "C", "legendFormat": "Thread creation failed"}, {"intervalFactor": 2, "expr": "varnish_main_threads_limited{instance=~\"^($varnish_instance).*\"}", "step": 60, "refId": "D", "legendFormat": "Max Threads hit"}, {"intervalFactor": 2, "expr": "varnish_main_threads{instance=~\"^($varnish_instance).*\"}", "step": 60, "refId": "E", "legendFormat": "Total number of threads"}, {"intervalFactor": 2, "expr": "varnish_main_thread_queue_len{instance=~\"^($varnish_instance).*\"}", "step": 60, "refId": "F", "legendFormat": "Length of session queue waiting for threads"}, {"intervalFactor": 2, "expr": "varnish_main_pools{instance=~\"^($varnish_instance).*\"}", "step": 60, "refId": "G", "legendFormat": "Number of thread pools   "}], "transparent": true, "yaxes": [{"logBase": 1, "show": true, "max": null, "format": "short", "min": null, "label": null}, {"logBase": 1, "show": true, "max": null, "format": "short", "min": null, "label": null}], "xaxis": {"buckets": null, "show": true, "values": [], "mode": "time", "name": null}, "seriesOverrides": [], "percentage": false, "type": "graph", "dashes": false, "error": false, "editable": true, "grid": {}, "dashLength": 10, "legend": {"total": false, "show": true, "max": true, "min": false, "current": true, "values": true, "alignAsTable": true, "avg": false}, "yaxis": {"align": false, "alignLevel": null}, "timeShift": null, "aliasColors": {}, "lines": true, "points": false, "datasource": "Prometheus", "pointradius": 5, "timeRegions": [], "options": {}}, {"title": "New row", "collapsed": false, "gridPos": {"y": 61, "h": 1, "w": 24, "x": 0}, "panels": [], "type": "row", "id": 29}, {"bars": false, "timeFrom": null, "links": [], "isNew": true, "thresholds": [], "spaceLength": 10, "nullPointMode": "connected", "renderer": "flot", "gridPos": {"y": 62, "h": 12, "w": 12, "x": 0}, "linewidth": 2, "steppedLine": false, "id": 22, "fill": 1, "title": "Bans", "tooltip": {"sort": 0, "shared": true, "value_type": "cumulative", "msResolution": false}, "stack": false, "targets": [{"intervalFactor": 2, "expr": "varnish_main_bans{instance=~\"^($varnish_instance).*\"}", "step": 60, "refId": "A", "legendFormat": "Count of Bans"}, {"intervalFactor": 2, "expr": "varnish_main_bans_completed{instance=~\"^($varnish_instance).*\"}", "step": 60, "refId": "B", "legendFormat": "Number of bans marked 'completed'"}, {"intervalFactor": 2, "expr": "varnish_main_bans_deleted{instance=~\"^($varnish_instance).*\"}", "step": 60, "refId": "C", "legendFormat": "Bans deleted"}, {"intervalFactor": 2, "expr": "varnish_main_bans_dups{instance=~\"^($varnish_instance).*\"}", "step": 60, "refId": "D", "legendFormat": "Bans superseded by other bans"}, {"intervalFactor": 2, "expr": "varnish_main_bans_obj{instance=~\"^($varnish_instance).*\"}", "step": 60, "refId": "I", "legendFormat": "Number of bans using obj.*"}, {"intervalFactor": 2, "expr": "varnish_main_bans_obj_killed{instance=~\"^($varnish_instance).*\"}", "step": 60, "refId": "J", "legendFormat": "Objects killed by bans (lookup)"}], "transparent": true, "yaxes": [{"logBase": 1, "show": true, "max": null, "format": "short", "min": null, "label": null}, {"logBase": 1, "show": true, "max": null, "format": "short", "min": null, "label": null}], "xaxis": {"buckets": null, "show": true, "values": [], "mode": "time", "name": null}, "seriesOverrides": [], "percentage": false, "type": "graph", "dashes": false, "error": false, "editable": true, "grid": {}, "dashLength": 10, "legend": {"sort": "current", "rightSide": false, "total": false, "min": false, "max": true, "show": true, "current": true, "values": true, "alignAsTable": true, "avg": true, "sortDesc": true}, "yaxis": {"align": false, "alignLevel": null}, "timeShift": null, "aliasColors": {}, "lines": true, "points": false, "datasource": "Prometheus", "pointradius": 5, "timeRegions": [], "decimals": 2, "options": {}}, {"bars": false, "timeFrom": null, "links": [], "isNew": true, "thresholds": [], "spaceLength": 10, "nullPointMode": "connected", "renderer": "flot", "gridPos": {"y": 62, "h": 12, "w": 12, "x": 12}, "linewidth": 2, "steppedLine": false, "id": 23, "fill": 1, "title": "Size of Ban Lists", "tooltip": {"sort": 0, "shared": true, "value_type": "cumulative", "msResolution": false}, "stack": false, "targets": [{"intervalFactor": 2, "expr": "varnish_main_bans_persisted_bytes{instance=~\"^($varnish_instance).*\"}", "step": 60, "refId": "K", "legendFormat": "Bytes used by the persisted ban lists"}, {"intervalFactor": 2, "expr": "varnish_main_bans_persisted_fragmentation{instance=~\"^($varnish_instance).*\"}", "step": 60, "refId": "L", "legendFormat": "Extra bytes in persisted ban lists due to fragmentation"}], "transparent": true, "yaxes": [{"logBase": 1, "show": true, "max": null, "format": "bytes", "min": null, "label": null}, {"logBase": 1, "show": true, "max": null, "format": "short", "min": null, "label": null}], "xaxis": {"buckets": null, "show": true, "values": [], "mode": "time", "name": null}, "seriesOverrides": [], "percentage": false, "type": "graph", "dashes": false, "error": false, "editable": true, "grid": {}, "dashLength": 10, "legend": {"sort": "current", "rightSide": false, "total": false, "min": false, "max": true, "show": true, "current": true, "values": true, "alignAsTable": true, "avg": true, "sortDesc": true}, "yaxis": {"align": false, "alignLevel": null}, "timeShift": null, "aliasColors": {}, "lines": true, "points": false, "datasource": "Prometheus", "pointradius": 5, "timeRegions": [], "options": {}}, {"bars": false, "timeFrom": null, "links": [], "isNew": true, "thresholds": [], "spaceLength": 10, "nullPointMode": "connected", "renderer": "flot", "gridPos": {"y": 74, "h": 12, "w": 12, "x": 0}, "linewidth": 2, "steppedLine": false, "id": 24, "fill": 1, "title": "Ban Lurker", "tooltip": {"sort": 0, "shared": true, "value_type": "cumulative", "msResolution": false}, "stack": false, "targets": [{"intervalFactor": 2, "expr": "varnish_main_bans_lurker_contention{instance=~\"^($varnish_instance).*\"}", "step": 60, "refId": "E", "legendFormat": "Lurker gave way for lookup"}, {"intervalFactor": 2, "expr": "varnish_main_bans_lurker_obj_killed{instance=~\"^($varnish_instance).*\"}", "step": 60, "refId": "F", "legendFormat": "Objects killed by bans (lurker)"}, {"intervalFactor": 2, "expr": "varnish_main_bans_lurker_tested{instance=~\"^($varnish_instance).*\"}", "step": 60, "refId": "G", "legendFormat": "Bans tested against objects (lurker)"}, {"intervalFactor": 2, "expr": "varnish_main_bans_lurker_tests_tested{instance=~\"^($varnish_instance).*\"}", "step": 60, "refId": "H", "legendFormat": "Ban tests tested against objects (lurker)"}], "transparent": true, "yaxes": [{"logBase": 1, "show": true, "max": null, "format": "short", "min": null, "label": null}, {"logBase": 1, "show": true, "max": null, "format": "short", "min": null, "label": null}], "xaxis": {"buckets": null, "show": true, "values": [], "mode": "time", "name": null}, "seriesOverrides": [], "percentage": false, "type": "graph", "dashes": false, "error": false, "editable": true, "grid": {}, "dashLength": 10, "legend": {"sort": "current", "rightSide": false, "total": false, "min": false, "max": true, "show": true, "current": true, "values": true, "alignAsTable": true, "avg": true, "sortDesc": true}, "yaxis": {"align": false, "alignLevel": null}, "timeShift": null, "aliasColors": {}, "lines": true, "points": false, "datasource": "Prometheus", "pointradius": 5, "timeRegions": [], "options": {}}], "id": 4, "templating": {"list": [{"regex": "/^(.*)/", "definition": "label_values(varnish_up, instance)", "multi": false, "hide": 0, "name": "varnish_instance", "tags": [], "allValue": null, "tagValuesQuery": "", "skipUrlSync": false, "refresh": 1, "label": "Instance", "current": {}, "sort": 1, "datasource": "Prometheus", "type": "query", "query": "label_values(varnish_up, instance)", "useTags": false, "tagsQuery": "", "options": [], "includeAll": true}]}}